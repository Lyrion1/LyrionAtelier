<!DOCTYPE html>
<html lang="en">
<head>
 <meta charset="UTF-8">
 <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
 <title>TEST - Stripe Checkout Test</title>
 <link rel="stylesheet" href="/styles/design-system.css">
 <link rel="stylesheet" href="css/style.css">
 <script src="https://js.stripe.com/v3/"></script>
 <style>
 body {
 font-family: Arial, sans-serif;
 max-width: 600px;
 margin: 100px auto;
 padding: 40px;
 background: #f5f5f5;
 }
 .test-banner {
 background: #ff0000;
 color: white;
 padding: 20px;
 text-align: center;
 font-weight: bold;
 font-size: 1.2rem;
 margin-bottom: 30px;
 border-radius: 8px;
 }
 .product-card {
 background: white;
 padding: 40px;
 border-radius: 12px;
 box-shadow: 0 4px 12px rgba(0,0,0,0.1);
 }
 h1 {
 color: #1a1a1a;
 margin-bottom: 10px;
 }
 .price {
 font-size: 2rem;
 color: #28a745;
 margin: 20px 0;
 }
 button {
 width: 100%;
 padding: 16px;
 background: #1a1a1a;
 color: white;
 border: none;
 border-radius: 8px;
 font-size: 1.1rem;
 font-weight: 600;
 cursor: pointer;
 transition: background 0.3s;
 }
 button:hover {
 background: #000;
 }
 .test-card-info {
 margin-top: 30px;
 padding: 20px;
 background: #fff3cd;
 border-radius: 8px;
 border-left: 4px solid #ffc107;
 }
 .test-card-info h3 {
 margin-top: 0;
 color: #856404;
 }
 .test-card-info p {
 margin: 5px 0;
 color: #856404;
 }
 </style>
</head>
<body>
<header class="site-header" data-nav-version="nav-v4">
 <nav class="main-nav">
 <a href="/" class="logo-link">
 <img src="/images/lyrion-logo.png" alt="Lyrīon Atelier" class="logo-img">
 <span class="brand-name">LYRĪON ATELIER</span>
 </a>
 
 <div class="nav-links">
 <a href="/">Home</a>
 <a href="/shop">Shop</a>
 <a href="/oracle">Oracle</a>
 <a href="/compatibility">Compatibility</a>
 <a href="/codex">Codex</a>
 <a href="/contact">Contact</a>
 <a href="/cart" class="cart-icon">Cart</a>
 </div>
 </nav>
</header>

 <div class="test-banner">
 TEST MODE ONLY - DO NOT USE FOR REAL PURCHASES 
 </div>

 <div class="product-card">
 <h1>Lyrion Billionaire Bag</h1>
        <p class="price">$1.00</p>
 <button id="checkout-button">Test Checkout</button>

 <div class="test-card-info">
 <h3>Test Card Details:</h3>
 <p><strong>Card:</strong> 4242 4242 4242 4242</p>
 <p><strong>Expiry:</strong> 12/25</p>
 <p><strong>CVC:</strong> 123</p>
 <p><strong>ZIP:</strong> 12345</p>
 </div>
 </div>

 <script src="js/main.js" defer></script>
 <script>
   const checkoutButton = document.getElementById('checkout-button');
   
   checkoutButton.addEventListener('click', async () => {
     checkoutButton.textContent = 'Loading...';
     checkoutButton.disabled = true;

     try {
       // Call backend to create checkout session
       const response = await fetch('/.netlify/functions/create-checkout', {
         method: 'POST',
         headers: {
           'Content-Type': 'application/json',
         },
         body: JSON.stringify({
           priceId: 'price_1ShjdBE6FRwoxLBfyUvK1ark',
           quantity: 1
         })
       });

       // Check if response is ok
       if (!response.ok) {
         const errorText = await response.text();
         throw new Error('Backend error: ' + errorText);
       }

       const data = await response.json();
       console.log('Backend response:', data); // Debug log

       // Check if sessionId exists
       if (!data.sessionId) {
         throw new Error('No sessionId received from backend');
       }

       // Initialize Stripe with your actual test key
       const stripe = Stripe('pk_test_51QTfpGE6FRwoxLBfmjKFgxWK2pPj3yhrwS8v7WV4u8vX0h3iOzGpShp7EwkIk2cZH03bMDdOX1i2aKwP0okCPUhf00zbfiYCfD');
       
       // Redirect to checkout
       const { error } = await stripe.redirectToCheckout({ 
         sessionId: data.sessionId 
       });

       if (error) {
         throw new Error(error.message);
       }
     } catch (e) {
       console.error('Checkout error:', e); // Debug log
       alert('Error: ' + e.message);
       checkoutButton.textContent = 'Test Checkout';
       checkoutButton.disabled = false;
     }
   });
 </script>
</body>
</html>
